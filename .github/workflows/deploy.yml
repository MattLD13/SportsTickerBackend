name: Deploy to OCI

on:
  push:
    branches: [ "main" ]  # Or "master" if your branch is named that

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Copy file via SCP
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          source: "app.py" # REPLACE THIS with your actual python filename in the repo
          target: "/home/ubuntu/"

      - name: Restart Server Service
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            # If your file is named something else in the repo, rename it to app.py here
            # mv /home/ubuntu/your_file.py /home/ubuntu/app.py 
            
            # Restart the service to apply changes
            sudo systemctl restart ticker
